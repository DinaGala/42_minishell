# **************************************************************************** #
#                                                                              #
#                                                         :::      ::::::::    #
#    Makefilejar                                        :+:      :+:    :+:    #
#                                                     +:+ +:+         +:+      #
#    By: nzhuzhle <nzhuzhle@student.42.fr>          +#+  +:+       +#+         #
#                                                 +#+#+#+#+#+   +#+            #
#    Created: 2023/12/07 21:22:24 by nzhuzhle          #+#    #+#              #
#    Updated: 2023/12/27 20:44:56 by nzhuzhle         ###   ########.fr        #
#                                                                              #
# **************************************************************************** #

NAME = ircserv

#########
RM = rm -f
CC = cc
CFLAGS = -Werror -Wextra -Wall -std=c++98 -g -fsanitize=address 
#########

#########
FILES = main initialize_sh printer parser_utils

SRC = $(addsuffix .c, $(FILES))

vpath %.c SRC SRC/commands
#########

#########
OBJ_DIR = obj/
OBJ = $(patsubst src/%.c, $(OBJ_DIR)%.o, $(SRC))
DEP = $(addprefix $(OBJ_DIR), $(SRC:.c=.d))
#########

#########
$(OBJ_DIR)/%.o: %.c
	@mkdir -p $(@D)
	@${CC} $(CFLAGS) -MMD -c $< -o $@

all: make_lib $(RLINE)
	@$(MAKE) $(NAME) --no-print-directory

make_lib:
	$(MAKE_LIBFT) 

$(NAME):: $(OBJ) ./$(LIBFT) ./$(RLINE) ./$(RHIST)
	@$(CC) $(CFLAGS) $(^) -ltermcap -lreadline -o $(NAME)

$(RLINE):
	@cd $(RLINE_PATH) && ./configure &>/dev/null
	@$(MAKE_RLINE) 
	@printf "Compiled READLINE succesfully!\n"

clean:
	@$(RM) $(OBJ) $(DEP) --no-print-directory
	@$(RM) -r $(OBJ_DIR) --no-print-directory
	@echo "OBJECTS REMOVEDðŸ˜­   "

fclean: clean
	@$(RM) $(NAME) --no-print-directory
	@echo "EVERYTHING REMOVEDðŸ˜­   "
	
re:	fclean all

.PHONY: all clean fclean re

-include $(DEP)